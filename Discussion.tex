
\section{Discussion}

\subsection{A Resource of genetically identified neuronal transcriptomes}

The dataset presented here is the largest collection of transcriptomes of anatomically and genetically specified neuronal cell types available in a mammalian species (Table 1). The approach employed in this study provides a complimentary view of neuronal diversity to that afforded by SC sequencing. By sorting and pooling $\sim$100 cells chosen based on genetic and anatomical similarity, we generated profiles with low noise and high depth, but, where tested, with a comparable degree of homogeneity, as that obtained in recent SC studies. 

The fact that each transcriptome corresponds to a genetically (or retrogradely) labeled population will foster reproducible studies across investigators. The few profiles in our study that mapped to more than one SC profile (Figure 2), may represent cell types better distinguishable using SCs or improved genetic markers, or alternatively, may represent cell populations that are highly overlapping. The optimal granularity with which cell types may be distinguished remains an open question. Pooling cell profiles either prior to sequencing, as in this study, or after sequencing at the clustering phase, as in SC studies, risks compromising profile homogeneity. However, over-fragmenting clusters risks the complimentary problem of reducing the reliability and reproducibility with which populations can be distinguished across studies. Given the complimentary advantages of improved reproducibility and separability afforded by pooling profiles, and of reduced heterogeneity afforded by maximally separating profiles, further integration of these approaches with other modalities, such as FISH \citep{Moffitt_2016} are needed to accurately profile the full census of brain cell types. By linking these efforts to genetically identified neurons, the present dataset provides a useful resource for these efforts. 

\subsection{A transcriptional code for neuronal diversity}
We utilized easily calculated metrics that capture essential features of the robustness and information content of transcriptome diversity. These measures are simply versions of Fold-Change (FCR) and Differential Expression (DEF) adapted to the analysis of many separate populations simultaneously. Importantly, they capture orthogonal components of variance-based metrics like ANOVA and CV (Figure 3 Supplement 1), and so may be more broadly useful when making genome-wide comparisons across many populations. In the present dataset, FCR and DEF identified two very different sets of genes contributing to neuronal diversity: high FCR, low noise genes, exemplified by homeobox transcription factors, and long neuronal effector genes like ion channels, receptors and cell adhesion molecules. 

The homeobox family of TFs exhibited the most robust (high FCR) expression differences across cell types (Figure 4D). These ON/OFF differences were characterized by extremely low expression in the OFF state (Figure 5). Mechanistically, the low expression was associated with reduced genome accessibility measured by ATAC-seq (Figure 5C,D), presumably reflecting epigenetic regulation of the OFF state, known to occur for example at the clustered Hox genes via Polycomb group (PcG) proteins \citep{Montavon_2014}. Although this regulation has been studied most extensively at Hox genes, genome-wide ChIP studies reveal that PcG proteins are bound to over 100 homeobox TFs in ES cells \citep{Boyer_2006}. Our results indicate that strong cell type-specific repression persists in the adult brain, presumably due to the continued functional importance of preventing even partial activation of inappropriate programs of neuronal identity. 

Although individually, homeobox TFs contain less information about cell types than long neuronal effector genes, their patterns of expression are highly orthogonal and therefore their joint expression pattern is highly informative. As a group, homeobox TFs distinguished 97\% of neuronal cell types profiled (Figure 5 Supplement 2). (Note this includes several Purkinje and Hippocampal pyramidal cell groups that may actually represent duplicate examples of the same cell types). Historically, homeobox TFs are well known to combinatorially regulate neuronal identity in Drosophila and C. elegans \citep{Kratsios_2017} and the vertebrate brainstem and spinal cord \citep{Dasen_2009,Philippidou_2013}. Our results suggest a broader importance of homeobox TFs throughout the mammalian nervous system. Continued expression of these factors in adult neurons suggests they likely also contribute to the maintenance of neuronal identity.

\subsection{Long genes shape neuronal diversity}
Our study suggests that long neuronal effector genes contribute disproportionately to neuronal diversity (Figure 7). Long genes are more expressed in neurons than in non-neuronal cells in the nervous system, a bias that was also present in SC datasets (Figure 7 Supplement 1,2) and that has been reported previously \cite{Sugino_2014,Gabel_2015,Zylka_2015}. These differences are greatest in the forebrain (Figure 7F; Figure 7 Supplement 2), perhaps reflecting the large numbers of distinct cell types in these regions and the enhanced ability of these genes to distinguish genetically and anatomically-identified cell populations (GACP) based on their expression. 

Long genes tend to have larger numbers of exons and therefore are likely to be expressed in a larger number of distinct isoforms as a result of alternative splicing (alternative start sites also contribute). We quantified differential splicing from analysis of junctional reads. Interestingly, branch probabilities at most sites of alternative splicing were highly bimodal (Figure 6A), suggesting that within each GACP, splicing is largely all or none, a finding previously reported in single immune cells \cite{Shalek_2013} but not found in some single neuron studies \cite{Gokce_2016}. This led to patterns that often flipped between high and low probabilities for a given branch as one traversed major brain region boundaries (Figure 6B). More than two thirds of these splicing events lead to inclusion or exclusion of known protein domains (Figure 6E), but many of these, as well as some of the remaining events that do not modify domain structure, also introduce a frame shift or premature stop codon, and so are predicted to lead to nonsense mediated decay (NMD). We did not directly test the contribution of NMD to transcript abundance, but our splicing results are consistent with the idea that this may be an important mechanism for regulating transcript stability and hence transcript abundance across different cell populations \citep{Yan_2015,Traunmuller_2014}. While differential splicing is able to distinguish fewer GACPs than transcript abundance (Figure 7E), this may be an underestimate for two reasons. First, as just noted, splicing may influence transcript abundance through NMD, and second, the sensitivity to detect splicing differences depends on an adequate number of junctional reads. Deeper sequencing could increase the apparent contribution of this component of neuronal diversity.     

Long genes are enriched in the signaling molecules, receptors and ion channels responsible for input/output transformations in neurons, and the cell adhesion molecules that specify neuronal connectivity. The finding that these genes play an important role in diversifying cortical interneurons \cite{Paul_2017} as well as distinguishing the larger set of populations studied here is sensible in light of the phenotypic diversity required for neuronal communication and connectivity. These genes are long because of long introns that are rich in transposons and other retroelements (). Whether or how this increased length has any functional significance for the regulation of these genes is unclear from our studies, but it is intriguing that these long genes are disrupted in forms of Autism Spectrum Disorders \citep{Zylka_2015,Wei_2016} and in the related developmental disorder Rett Syndrome \citep{Sugino_2014,Gabel_2015}, where loss of the chromatin protein Mecp2 leads to selective upregulation of long neuronal genes in a highly cell type-specific fashion. These studies suggest the possibility that long neuronal genes are subject to distinct modes of regulation, with particular significance for neuronal diversity.   

In contrast to long neuronal effector genes, which tend to be expressed later in development as neurons mature phenotypically, low noise, high FCR genes are frequently critical for early development. These genes, such as many of the homeobox TFs, are often quite short and, at least in the case of the Hox genes, are known to be remarkably transposon impoverished \citep{Chinwalla_2002,Simons_2005}. This may reflect selection against transposon insertion, but may also reflect chromatin that is non-permissive for insertion in germ cells and the early embryo, where heritable transposition occurs. The high FCR/low noise of many of these genes detected here may reflect a transcriptional signature of this class of genes. Highly restrictive chromatin at these genes may be established early in development to protect them from disruptive transposition \citep{Montavon_2014}. If so, this tightly closed state is maintained in postmitotic neurons where it may also prevent transcriptional signals associated with inappropriate neural identities. 

Retroelement insertions are the major drivers of genome expansion, and can generate new promoters, introns, exons and distal regulatory elements through a process called "exaptation" (for review see \citealt{Chuong_2016}). For example, the set of neuronal genes regulated by REST is suggested to have evolved through retrotransposon-mediated duplication of REST binding sites \citep{Johnson_2006}. Similarly, mobile elements have helped distribute enhancers important for mammalian innate immunity \cite{Chuong_2016a}, shaped genome regulatory organization via distribution of the vertebrate insulator component CTCF \citep{Schmidt_2012}, and helped diversify placental function across mammalian lineages \citep{Chuong_2013}. However, these fortuitous benefits of an evolutionary arms race between "selfish" mobile elements and host genomes are likely rare. Most insertional events that are not selected against due to mutation, are likely neutral \cite{Zhang_2011}. However, even if elongation through insertion is on balance neutral, it may create a reservoir of genetic elements, providing fodder for subsequent regulatory innovation. We hypothesize that cellular diversifiation advantages accruing from a subset of these regulatory changes could help explain the paradox of why long genes should be abundantly expressed in CNS neurons despite their metabolic costs and the fact that these genes are sites of genome instability associated with genetic lesions leading to autism and other developmental disorders \citep{Wei_2016}. 

%This hypothesis also shifts focus away from short, developmental time scales considered in other hypotheses linking transposon insertion to neuronal function \citep{Muotri_2005,Richardson_2014,Perrat_2013}. Instead of DNA rearrangements in neuronal progenitors producing neuronal diversity, we consider the time scales of evolution and thus also shift focus to the germ line, where natural selection has its influence. 



